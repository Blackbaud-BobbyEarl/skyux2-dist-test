{"version":3,"sources":["../../../.srctemp/modules/list-data-provider-in-memory/list-data-in-memory.provider.ts"],"names":[],"mappings":"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","file":"list-data-in-memory.provider.js","sourceRoot":"","sourcesContent":["import { Observable } from 'rxjs/Observable';\nimport { BehaviorSubject } from 'rxjs/BehaviorSubject';\n\nimport { ListDataProvider } from '../list/list-data.provider';\nimport { ListDataRequestModel } from '../list/list-data-request.model';\nimport { ListDataResponseModel } from '../list/list-data-response.model';\nimport { ListItemModel } from '../list/state/items/item.model';\nimport { ListSearchModel } from '../list/state/search/search.model';\nimport { ListFilterModel } from '../list/state/filters/filter.model';\n\nimport {\n  compare,\n  getData\n} from '../list/helpers';\n\nconst moment = require('moment');\n\nexport class SkyListInMemoryDataProvider extends ListDataProvider {\n  public items: BehaviorSubject<Array<ListItemModel>> =\n    new BehaviorSubject<Array<ListItemModel>>([]);\n\n  private lastItems: ListItemModel[];\n  private lastSearch: ListSearchModel;\n  private lastSearchResults: ListItemModel[];\n  private searchFunction: (data: any, searchText: string) => boolean;\n\n  private lastFilters: ListFilterModel[];\n  private lastFilterResults: ListItemModel[];\n\n  constructor(\n    data?: Observable<Array<any>>,\n    searchFunction?: (data: any, searchText: string) => boolean\n  ) {\n    super(data);\n\n    this.searchFunction = searchFunction;\n\n    if (data) {\n      data.subscribe(items => {\n        this.items.next(items.map(d =>\n          new ListItemModel(d.id || moment().toDate().getTime().toString() , d)\n        ));\n      });\n    }\n  }\n\n  public count(): Observable<number> {\n    return this.items.map((items) => items.length);\n  }\n\n  public get(request: ListDataRequestModel): Observable<ListDataResponseModel> {\n    return this.filteredItems(request).map((result: Array<ListItemModel>) => {\n        if (request.pageNumber && request.pageSize) {\n          let itemStart = (request.pageNumber - 1) * request.pageSize;\n          let pagedResult = result.slice(itemStart, itemStart + request.pageSize);\n          return new ListDataResponseModel({\n            count: result.length,\n            items: pagedResult\n          });\n        } else {\n          return new ListDataResponseModel({\n            count: result.length,\n            items: result\n          });\n        }\n\n    });\n  }\n\n  private filteredItems(request: ListDataRequestModel): Observable<Array<ListItemModel>> {\n    return this.items.map(items => {\n      let dataChanged = false;\n      let search = request.search;\n      let sort = request.sort;\n      let filters = request.filters;\n\n      if (this.lastItems === undefined || this.lastItems !== items) {\n        dataChanged = true;\n        this.lastItems = items;\n      }\n\n      let searchChanged = false;\n      if (this.lastSearch === undefined || this.lastSearch !== search) {\n        searchChanged = true;\n        this.lastSearch = search;\n      }\n\n      let filtersChanged = false;\n\n      if (this.lastFilters === undefined || this.lastFilters !== filters) {\n        filtersChanged = true;\n        this.lastFilters = filters;\n      }\n\n      let result = items;\n\n      if (!dataChanged && !filtersChanged && this.lastFilterResults !== undefined) {\n        result = this.lastFilterResults;\n      } else if (filters && filters.length > 0) {\n        result = result.filter(item => {\n          for (let i = 0; i < filters.length; i++) {\n            let filter = filters[i];\n            if (filter.value === undefined ||\n              filter.value === '' ||\n              filter.value === false ||\n              filter.value === filter.defaultValue) {\n              continue;\n            }\n\n            if (!filter.filterFunction(item, filter.value)) {\n              return false;\n            }\n          }\n          return true;\n        });\n\n        this.lastFilterResults = result;\n      } else {\n        this.lastFilterResults = undefined;\n      }\n\n      if (!dataChanged && !searchChanged && this.lastSearchResults !== undefined) {\n        result = this.lastSearchResults;\n      } else if (search && search.searchText !== undefined && search.searchText.length > 0) {\n        let searchText = search.searchText.toLowerCase();\n        let searchFunctions: any[];\n        if (this.searchFunction !== undefined) {\n          searchFunctions = [this.searchFunction];\n        } else {\n          searchFunctions = search.functions;\n        }\n\n        result = result.filter(item => {\n          let isMatch = false;\n\n          for (let i = 0; i < searchFunctions.length; i++) {\n            let searchFunction = searchFunctions[i];\n            let searchResult = searchFunction(item.data, searchText);\n\n            if (\n              (typeof searchResult === 'string' && searchResult.indexOf(searchText) !== -1) ||\n              searchResult === true\n            ) {\n              isMatch = true;\n              break;\n            }\n          }\n\n          return isMatch;\n        });\n\n        this.lastSearchResults = result;\n      } else {\n        this.lastSearchResults = undefined;\n      }\n\n      if (sort && sort.fieldSelectors.length > 0) {\n        result = result.slice().sort((item1: ListItemModel, item2: ListItemModel) => {\n          let compareResult = 0;\n          for (let i = 0; i < sort.fieldSelectors.length; i++) {\n            let selector = sort.fieldSelectors[i];\n            let value1 = getData(item1.data, selector.fieldSelector);\n            let value2 = getData(item2.data, selector.fieldSelector);\n\n            compareResult = compare(value1, value2);\n\n            if (selector.descending && compareResult !== 0) {\n              compareResult *= -1;\n            }\n\n            if (compareResult !== 0) {\n              break;\n            }\n          }\n\n          return compareResult;\n        });\n      }\n      return result;\n    });\n  }\n}\n"]}