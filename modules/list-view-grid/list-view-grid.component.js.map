{"version":3,"sources":["../../../.srctemp/modules/list-view-grid/list-view-grid.component.ts"],"names":[],"mappings":"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","file":"list-view-grid.component.js","sourceRoot":"","sourcesContent":["import {\n  AfterContentInit,\n  ChangeDetectionStrategy,\n  Component,\n  ContentChildren,\n  forwardRef,\n  Input,\n  OnDestroy,\n  QueryList,\n  ViewChild\n} from '@angular/core';\n\nimport { Observable } from 'rxjs/Observable';\nimport { Subject } from 'rxjs/Subject';\nimport 'rxjs/add/operator/distinctUntilChanged';\nimport 'rxjs/add/operator/take';\nimport 'rxjs/add/operator/takeUntil';\n\nimport {\n  getValue\n} from 'microedge-rxstate/dist/helpers';\n\nimport {\n  AsyncList\n} from 'microedge-rxstate/dist';\n\nimport {\n  SkyGridComponent,\n  SkyGridColumnComponent,\n  SkyGridColumnHeadingModelChange,\n  SkyGridColumnModel\n} from '../grid';\n\nimport {\n  ListItemModel,\n  ListSortFieldSelectorModel,\n  ListSearchModel,\n  ListStateDispatcher,\n  ListState\n} from '../list/state';\n\nimport {\n  getData,\n  isObservable\n} from '../list/helpers';\n\nimport { ListViewComponent } from '../list/list-view.component';\n\nimport {\n  GridState,\n  GridStateDispatcher,\n  GridStateModel\n} from './state';\n\nimport { ListViewGridColumnsLoadAction } from './state/columns/actions';\nimport { ListViewDisplayedGridColumnsLoadAction } from './state/displayed-columns/actions';\n\n\nexport class SkyListViewGridComponent\n  extends ListViewComponent implements AfterContentInit, OnDestroy {\n\n  \n  public set name(value: string) {\n    this.viewName = value;\n  }\n\n  \n  public displayedColumns: Array<string> | Observable<Array<string>>;\n\n  \n  public hiddenColumns: Array<string> | Observable<Array<string>>;\n\n  \n  public fit: string = 'width';\n\n  \n  public width: number | Observable<number>;\n\n  \n  public height: number | Observable<number>;\n\n  \n  public gridComponent: SkyGridComponent;\n\n  public columns: Observable<Array<SkyGridColumnModel>>;\n\n  public selectedColumnIds: Observable<Array<string>>;\n\n  public items: Observable<ListItemModel[]>;\n\n  public loading: Observable<boolean>;\n\n  public sortField: Observable<ListSortFieldSelectorModel>;\n\n  /* tslint:disable */\n  \n  private searchFunction: (data: any, searchText: string) => boolean;\n  /* tslint:enable */\n\n  \n  private columnComponents: QueryList<SkyGridColumnComponent>;\n\n  private ngUnsubscribe = new Subject();\n\n  constructor(\n    state: ListState,\n    private dispatcher: ListStateDispatcher,\n    public gridState: GridState,\n    public gridDispatcher: GridStateDispatcher\n  ) {\n    super(state, 'Grid View');\n  }\n\n  public ngAfterContentInit() {\n    if (this.columnComponents.length === 0) {\n      throw new Error('Grid view requires at least one sky-grid-column to render.');\n    }\n\n    let columnModels = this.columnComponents.map(columnComponent => {\n      return new SkyGridColumnModel(columnComponent.template, columnComponent);\n    });\n\n    if (this.width && !isObservable(this.width)) {\n      this.width = Observable.of(this.width);\n    }\n\n    if (this.height && !isObservable(this.height)) {\n      this.height = Observable.of(this.height);\n    }\n\n    // Setup Observables for template\n    this.columns = this.gridState.map(s => s.columns.items).distinctUntilChanged();\n\n    this.selectedColumnIds = this.getSelectedIds();\n\n    this.items = this.getGridItems();\n\n    this.loading = this.state.map((s) => {\n      return s.items.loading;\n    }).distinctUntilChanged();\n\n    this.sortField = this.state.map((s) => {\n      /* istanbul ignore else */\n      /* sanity check */\n      if (s.sort && s.sort.fieldSelectors) {\n        return s.sort.fieldSelectors[0];\n      }\n      /* istanbul ignore next */\n      /* sanity check */\n      return undefined;\n    }).distinctUntilChanged();\n\n    this.gridState.map(s => s.columns.items)\n      .takeUntil(this.ngUnsubscribe)\n      .distinctUntilChanged()\n      .subscribe(columns => {\n        if (this.hiddenColumns) {\n          getValue(this.hiddenColumns, (hiddenColumns: string[]) => {\n            this.gridDispatcher.next(\n              new ListViewDisplayedGridColumnsLoadAction(\n                columns.filter(x => {\n                  /* istanbul ignore next */\n                  /* sanity check */\n                  let id = x.id || x.field;\n                  return hiddenColumns.indexOf(id) === -1;\n                }),\n                true\n              )\n            );\n          });\n\n        } else if (this.displayedColumns) {\n          getValue(this.displayedColumns, (displayedColumns: string[]) => {\n            this.gridDispatcher.next(\n              new ListViewDisplayedGridColumnsLoadAction(\n                columns.filter(x => displayedColumns.indexOf(x.id || x.field) !== -1),\n                true\n              )\n            );\n          });\n\n        } else {\n          this.gridDispatcher.next(\n            new ListViewDisplayedGridColumnsLoadAction(columns.filter(x => !x.hidden), true)\n          );\n        }\n      });\n\n    this.gridDispatcher.next(new ListViewGridColumnsLoadAction(columnModels, true));\n\n    this.handleColumnChange();\n  }\n\n  public ngOnDestroy() {\n    this.ngUnsubscribe.next();\n    this.ngUnsubscribe.complete();\n  }\n\n  public columnIdsChanged(selectedColumnIds: Array<string>) {\n    this.gridState.map(s => s.columns.items)\n        .take(1)\n        .subscribe(columns => {\n          let displayedColumns = selectedColumnIds.map(\n            columnId => columns.filter(c => c.id === columnId)[0]\n          );\n          this.gridDispatcher.next(\n            new ListViewDisplayedGridColumnsLoadAction(displayedColumns, true)\n          );\n        });\n  }\n\n  public sortFieldChanged(sortField: ListSortFieldSelectorModel) {\n    this.dispatcher.sortSetFieldSelectors([sortField]);\n  }\n\n  public onViewActive() {\n    this.gridState.map(s => s.displayedColumns.items)\n      .takeUntil(this.ngUnsubscribe)\n      .distinctUntilChanged()\n      .subscribe(displayedColumns => {\n        let setFunctions =\n          this.searchFunction !== undefined ? [this.searchFunction] :\n            displayedColumns\n              .map(column => (data: any, searchText: string) =>\n                column.searchFunction(getData(data, column.field), searchText)\n              )\n              .filter(c => c !== undefined);\n\n        this.state.take(1).subscribe(s => {\n          this.dispatcher.searchSetOptions(new ListSearchModel({\n            searchText: s.search.searchText,\n            functions: setFunctions,\n            fieldSelectors: displayedColumns.map(d => d.field)\n          }));\n        });\n      });\n  }\n\n  private handleColumnChange() {\n     // watch for changes in column components\n    this.columnComponents.changes\n      .takeUntil(this.ngUnsubscribe)\n      .subscribe((columnComponents) => {\n        let columnModels = this.columnComponents.map(column => {\n          return new SkyGridColumnModel(column.template, column);\n        });\n        this.gridDispatcher.next(new ListViewGridColumnsLoadAction(columnModels, true));\n      });\n\n    // Watch for column heading changes:\n    this.columnComponents.forEach((comp: SkyGridColumnComponent) => {\n      comp.headingModelChanges\n        .takeUntil(this.ngUnsubscribe)\n        .subscribe((change: SkyGridColumnHeadingModelChange) => {\n          this.gridComponent.updateColumnHeading(change);\n        });\n    });\n  }\n\n  private getGridItems(): Observable<Array<ListItemModel>> {\n    /*\n      Ran into problem where state updates were consumed out of order. For example, on search text\n      update, the searchText update was consumed after the resulting list item update. Scanning the\n      previous value of items lastUpdate ensures that we only receive the latest items.\n    */\n    return this.state.map((s) => {\n        return s.items;\n    })\n    .scan((previousValue: AsyncList<ListItemModel>, newValue: AsyncList<ListItemModel>) => {\n      if (previousValue.lastUpdate > newValue.lastUpdate) {\n        return previousValue;\n      } else {\n        return newValue;\n      }\n    })\n    .map((result: AsyncList<ListItemModel>) => {\n      return result.items;\n    })\n    .distinctUntilChanged();\n  }\n\n  private getSelectedIds(): Observable<Array<string>> {\n    /*\n      Same problem as above. We should move from having a state object observable with a bunch of\n      static properties to a static state object with observable properties that you can subscribe\n      to.\n    */\n    return this.gridState\n      .map(s => s.displayedColumns)\n      .scan(\n        (previousValue: AsyncList<SkyGridColumnModel>, newValue: AsyncList<SkyGridColumnModel>) => {\n        if (previousValue.lastUpdate > newValue.lastUpdate) {\n          return previousValue;\n        } else {\n          return newValue;\n        }\n      })\n      .map((result: AsyncList<SkyGridColumnModel>) => {\n        /* istanbul ignore next */\n        /* sanity check */\n        return result.items.map((column: SkyGridColumnModel) => {\n          return column.id || column.field;\n        });\n      }).distinctUntilChanged();\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'sky-list-view-grid',\n  template: `<div *ngIf=\"active | async\">\n  <sky-grid\n    #skyGrid\n    [height]=\"height | async\"\n    [width]=\"width | async\"\n    [fit]=\"fit\"\n    [data]=\"items | async\"\n    [selectedColumnIds]=\"selectedColumnIds | async\"\n    [columns]=\"columns | async\"\n    [hasToolbar]=\"hasToolbar | async\"\n    (selectedColumnIdsChange)=\"columnIdsChanged($event)\"\n    [sortField]=\"sortField | async\"\n    (sortFieldChange)=\"sortFieldChanged($event)\"\n    >\n  </sky-grid>\n  <sky-wait [isWaiting]=\"loading | async\"></sky-wait>\n</div>\n`,\n  providers: [\n    /* tslint:disable */\n    { provide: ListViewComponent, useExisting: forwardRef(() => SkyListViewGridComponent)},\n    /* tslint:enable */\n    GridState,\n    GridStateDispatcher,\n    GridStateModel\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ListState, },\n{type: ListStateDispatcher, },\n{type: GridState, },\n{type: GridStateDispatcher, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'name': [{ type: Input },],\n'displayedColumns': [{ type: Input },],\n'hiddenColumns': [{ type: Input },],\n'fit': [{ type: Input },],\n'width': [{ type: Input },],\n'height': [{ type: Input },],\n'gridComponent': [{ type: ViewChild, args: [SkyGridComponent, ] },],\n'searchFunction': [{ type: Input, args: ['search', ] },],\n'columnComponents': [{ type: ContentChildren, args: [SkyGridColumnComponent, {descendants: true}, ] },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}